<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamify Your Goals</title>
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Chart.js for canvas-based data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* A little custom CSS for the "Level Up" modal animation */
        #level-up-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        #level-up-modal.hidden {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans p-4 md:p-8 h-full overflow-y-auto">

    <div class="max-w-6xl mx-auto">
        
        <header class="mb-6">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                Gamify Your Life
            </h1>
            <p class="text-gray-400">Add your goals, complete them, and level up!</p>
        </header>

        <!-- ============================================= -->
        <!-- 1. GAMIFICATION & STATS SECTION (Hybrid)      -->
        <!-- ============================================= -->
        <section class="mb-8 p-6 bg-gray-800 rounded-lg shadow-xl">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Player Level -->
                <div class="flex flex-col items-center justify-center bg-gray-700 p-4 rounded-lg">
                    <span class="text-sm font-medium text-gray-400">LEVEL</span>
                    <span id="player-level" class="text-5xl font-bold text-yellow-400">1</span>
                </div>
                
                <!-- Player Streak -->
                <div class="flex flex-col items-center justify-center bg-gray-700 p-4 rounded-lg">
                    <span class="text-sm font-medium text-gray-400">STREAK</span>
                    <span id="player-streak" class="text-5xl font-bold text-red-500">0</span>
                    <span class="text-gray-400">days</span>
                </div>

                <!-- XP Bar (Canvas) -->
                <div class="md:col-span-3 flex flex-col justify-center bg-gray-700 p-4 rounded-lg">
                    <div class="flex justify-between text-sm font-medium mb-2">
                        <span class="text-gray-400">XP Progress</span>
                        <span id="xp-text" class="text-gray-300">0 / 100</span>
                    </div>
                    <!-- This canvas is drawn on by the native Canvas 2D API -->
                    <canvas id="xp-bar-canvas" class="w-full h-8 bg-gray-800 rounded-full overflow-hidden"></canvas>
                </div>
            </div>
        </section>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- ============================================= -->
            <!-- 2. GOAL MANAGEMENT SECTION (Standard HTML)    -->
            <!-- ============================================= -->
            <main class="lg:col-span-2">
                <section class="mb-8">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-300">Add New Goal (Quest)</h2>
                    <form id="add-goal-form" class="flex flex-col md:flex-row gap-4">
                        <input type="text" id="goal-text" placeholder="What's your quest?" class="flex-grow bg-gray-700 text-white p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        
                        <select id="goal-category" class="bg-gray-700 text-white p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="personal">Personal</option>
                        </select>
                        
                        <select id="goal-difficulty" class="bg-gray-700 text-white p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="easy">Easy (10 XP)</option>
                            <option value="medium">Medium (25 XP)</option>
                            <option value="hard">Hard (50 XP)</option>
                        </select>
                        
                        <button type="submit" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:from-purple-600 hover:to-pink-600 transition duration-300">
                            Add Quest
                        </button>
                    </form>
                </section>

                <section>
                    <h2 class="text-2xl font-semibold mb-4 text-purple-300">Active Quests</h2>
                    <ul id="goal-list" class="space-y-3">
                        <!-- Goals will be dynamically inserted here by JavaScript -->
                        <li class="bg-gray-800 p-4 rounded-lg flex items-center justify-between shadow">
                            <span class="text-gray-500 italic">No quests yet. Add one above!</span>
                        </li>
                    </ul>
                </section>
            </main>

            <!-- ============================================= -->
            <!-- 3. ANALYSIS SECTION (Chart.js Canvas)         -->
            <!-- ============================================= -->
            <aside class="lg:col-span-1">
                <h2 class="text-2xl font-semibold mb-4 text-purple-300">Analysis Dashboard</h2>
                
                <!-- Chart 1: Category Breakdown -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8">
                    <h3 class="text-lg font-medium text-gray-300 mb-4">Completed by Category</h3>
                    <!-- This canvas is controlled by Chart.js -->
                    <canvas id="category-chart"></canvas>
                </div>
                
                <!-- Chart 2: Progress Overview -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                    <h3 class="text-lg font-medium text-gray-300 mb-4">Progress Overview</h3>
                    <!-- This canvas is controlled by Chart.js -->
                    <canvas id="progress-chart"></canvas>
                </div>
            </aside>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- LEVEL UP MODAL (Standard HTML)                -->
    <!-- ============================================= -->
    <div id="level-up-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 p-8 md:p-12 rounded-lg shadow-2xl text-center border-4 border-yellow-400 max-w-md w-full">
            <span class="text-8xl" role="img" aria-label="party popper">ðŸŽ‰</span>
            <h2 class="text-5xl font-bold text-yellow-300 my-4">LEVEL UP!</h2>
            <p class="text-2xl text-gray-200 mb-2">You've reached</p>
            <p id="new-level-text" class="text-6xl font-bold text-white mb-6">Level 2</p>
            <p class="text-gray-400 mb-6">Your quests are getting harder, but you're getting stronger. Keep it up!</p>
            <button id="close-modal-btn" class="bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-lg text-lg hover:bg-yellow-400 transition duration-300">
                Continue
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =============================================
            // STATE & CONFIGURATION
            // =============================================
            
            let goals = []; // Our main list of goal objects
            let playerStats = {
                level: 1,
                xp: 0,
                xpToNextLevel: 100,
                streak: 0
            };
            
            const difficultyXP = {
                easy: 10,
                medium: 25,
                hard: 50
            };

            // Chart.js instances
            let categoryChartInstance = null;
            let progressChartInstance = null;

            // DOM Element References
            const goalList = document.getElementById('goal-list');
            const addGoalForm = document.getElementById('add-goal-form');
            const goalTextInput = document.getElementById('goal-text');
            const goalCategoryInput = document.getElementById('goal-category');
            const goalDifficultyInput = document.getElementById('goal-difficulty');
            
            const levelText = document.getElementById('player-level');
            const streakText = document.getElementById('player-streak');
            const xpText = document.getElementById('xp-text');
            const xpBarCanvas = document.getElementById('xp-bar-canvas');

            const modal = document.getElementById('level-up-modal');
            const newLevelText = document.getElementById('new-level-text');
            const closeModalBtn = document.getElementById('close-modal-btn');

            // =============================================
            // CORE LOGIC (Adding & Completing Goals)
            // =============================================

            // Add Goal Form Submission
            addGoalForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const text = goalTextInput.value.trim();
                if (text) {
                    const newGoal = {
                        id: Date.now(),
                        text: text,
                        category: goalCategoryInput.value,
                        difficulty: goalDifficultyInput.value,
                        completed: false
                    };
                    goals.push(newGoal);
                    renderGoals();
                    updateAllVisuals();
                    goalTextInput.value = '';
                }
            });

            // Handle Clicks on the Goal List (Complete/Delete)
            goalList.addEventListener('click', (e) => {
                const target = e.target;
                const goalId = target.closest('li')?.dataset.id;
                if (!goalId) return;

                const goal = goals.find(g => g.id == goalId);

                // Clicked the Checkbox
                if (target.type === 'checkbox') {
                    goal.completed = target.checked;
                    if (goal.completed) {
                        // Give XP!
                        const xpGained = difficultyXP[goal.difficulty] || 10;
                        addXP(xpGained);
                    }
                    // We re-render goals to apply the 'line-through' style
                    renderGoals(); 
                }
                
                // Clicked the Delete Button
                if (target.closest('.delete-btn')) {
                    goals = goals.filter(g => g.id != goalId);
                    renderGoals();
                }

                // Update charts after any change
                updateAllVisuals();
            });

            // Close Modal Button
            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // =============================================
            // GAMIFICATION LOGIC
            // =============================================
            
            function addXP(amount) {
                playerStats.xp += amount;
                
                if (playerStats.xp >= playerStats.xpToNextLevel) {
                    levelUp();
                }
                
                updateAllVisuals();
            }

            function levelUp() {
                playerStats.level++;
                playerStats.xp = playerStats.xp - playerStats.xpToNextLevel; // Rollover XP
                playerStats.xpToNextLevel = Math.floor(playerStats.xpToNextLevel * 1.5); // Increase difficulty
                
                // Show Level Up Modal
                newLevelText.textContent = `Level ${playerStats.level}`;
                modal.classList.remove('hidden');
                
                // TODO: Add a check for streak updates
                // This is complex, would involve checking Date() of last completion
                // For demo, we just increment it on level up as a placeholder
                playerStats.streak++;
            }

            // =============================================
            // RENDERING & DRAWING
            // =============================================

            function renderGoals() {
                goalList.innerHTML = ''; // Clear the list

                if (goals.length === 0) {
                    goalList.innerHTML = `<li class="bg-gray-800 p-4 rounded-lg flex items-center justify-between shadow">
                        <span class="text-gray-500 italic">No quests yet. Add one above!</span>
                    </li>`;
                    return;
                }

                goals.forEach(goal => {
                    const li = document.createElement('li');
                    li.dataset.id = goal.id;
                    li.className = `bg-gray-800 p-4 rounded-lg flex items-center justify-between shadow transition-opacity ${goal.completed ? 'opacity-50' : ''}`;
                    
                    const categoryColors = {
                        work: 'border-blue-500',
                        health: 'border-green-500',
                        personal: 'border-yellow-500'
                    };
                    
                    const difficultyColors = {
                        easy: 'text-green-400',
                        medium: 'text-yellow-400',
                        hard: 'text-red-400'
                    };

                    li.innerHTML = `
                        <div class="flex items-center gap-4">
                            <input type="checkbox" class="h-6 w-6 rounded bg-gray-700 border-gray-600 text-purple-500 focus:ring-purple-600" ${goal.completed ? 'checked' : ''}>
                            <div class="flex flex-col">
                                <span class="text-lg ${goal.completed ? 'line-through text-gray-500' : 'text-gray-100'}">
                                    ${goal.text}
                                </span>
                                <span class="text-sm text-gray-400">
                                    <span class="font-medium ${difficultyColors[goal.difficulty] || 'text-gray-400'}">${goal.difficulty.toUpperCase()}</span>
                                    &bull;
                                    <span>${goal.category}</span>
                                </span>
                            </div>
                        </div>
                        <button class="delete-btn text-gray-500 hover:text-red-500 transition-colors p-2 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    `;
                    li.classList.add('border-l-4', categoryColors[goal.category] || 'border-gray-700');
                    goalList.appendChild(li);
                });
            }

            /**
             * This function updates ALL visuals based on the current state.
             * It's called after any state change (add/complete/delete goal).
             */
            function updateAllVisuals() {
                // 1. Update simple HTML text
                levelText.textContent = playerStats.level;
                streakText.textContent = playerStats.streak;
                xpText.textContent = `${playerStats.xp} / ${playerStats.xpToNextLevel}`;

                // 2. Redraw the native canvas XP bar
                drawXpBar();

                // 3. Redraw the Chart.js canvases
                drawAnalysisCharts();
            }

            // --- NATIVE CANVAS API DRAWING ---
            function drawXpBar() {
                const ctx = xpBarCanvas.getContext('2d');
                const width = xpBarCanvas.width;
                const height = xpBarCanvas.height;
                
                // Ensure canvas resolution matches its display size
                xpBarCanvas.width = xpBarCanvas.clientWidth;
                xpBarCanvas.height = xpBarCanvas.clientHeight;
                
                const progress = playerStats.xp / playerStats.xpToNextLevel;
                const filledWidth = width * progress;

                // 1. Draw the background
                ctx.fillStyle = '#374151'; // gray-700
                ctx.clearRect(0, 0, width, height); // Clear first
                ctx.fillRect(0, 0, width, height);
                
                // 2. Draw the filled XP
                // Create a gradient for the bar
                const gradient = ctx.createLinearGradient(0, 0, width, 0);
                gradient.addColorStop(0, '#a855f7'); // purple-500
                gradient.addColorStop(1, '#ec4899'); // pink-500
                
                ctx.fillStyle = gradient;
                // Animate the fill (simple, non-blocking)
                // In a real app, you'd use requestAnimationFrame for a smooth fill
                ctx.fillRect(0, 0, filledWidth, height);
            }

            // --- CHART.JS CANVAS DRAWING ---
            function drawAnalysisCharts() {
                // --- 1. Category Chart (Pie) ---
                const categoryCtx = document.getElementById('category-chart').getContext('2d');
                const completedGoals = goals.filter(g => g.completed);
                
                const categoryCounts = { work: 0, health: 0, personal: 0 };
                completedGoals.forEach(g => {
                    if (categoryCounts.hasOwnProperty(g.category)) {
                        categoryCounts[g.category]++;
                    }
                });

                const pieData = {
                    labels: ['Work', 'Health', 'Personal'],
                    datasets: [{
                        data: [categoryCounts.work, categoryCounts.health, categoryCounts.personal],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b'], // blue, green, yellow
                        borderColor: '#4b5563', // gray-600
                    }]
                };
                
                if (categoryChartInstance) {
                    categoryChartInstance.destroy(); // Destroy old chart to redraw
                }
                categoryChartInstance = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: pieData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: { color: '#d1d5db' } // gray-300
                            }
                        }
                    }
                });
                
                // --- 2. Progress Chart (Bar) ---
                const progressCtx = document.getElementById('progress-chart').getContext('2d');
                const pendingCount = goals.filter(g => !g.completed).length;
                const completedCount = goals.length - pendingCount;
                
                const barData = {
                    labels: ['Goals'],
                    datasets: [
                        {
                            label: 'Completed',
                            data: [completedCount],
                            backgroundColor: '#10b981', // green-500
                        },
                        {
                            label: 'Pending',
                            data: [pendingCount],
                            backgroundColor: '#6b7280', // gray-500
                        }
                    ]
                };
                
                if (progressChartInstance) {
                    progressChartInstance.destroy();
                }
                progressChartInstance = new Chart(progressCtx, {
                    type: 'bar',
                    data: barData,
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        scales: {
                            x: { 
                                stacked: true, 
                                ticks: { color: '#d1d5db' }, 
                                grid: { color: '#4b5563' } 
                            },
                            y: { 
                                stacked: true, 
                                ticks: { color: '#d1d5db' }, 
                                grid: { display: false } 
                            }
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#d1d5db' }
                            }
                        }
                    }
                });
            }

            // =============================================
            // INITIALIZATION
            // =============================================
            function init() {
                // Add some mock data to start
                goals = [
                    { id: 1, text: 'Read 1 chapter', category: 'personal', difficulty: 'easy', completed: true },
                    { id: 2, text: '30 min workout', category: 'health', difficulty: 'medium', completed: false },
                    { id: 3, text: 'Finish project report', category: 'work', difficulty: 'hard', completed: false },
                ];
                playerStats.xp = 10; // From the one completed goal
                
                renderGoals();
                updateAllVisuals();
            }
            
            init(); // Run the app
        });
    </script>

</body>
</html>

