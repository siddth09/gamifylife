<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamify Your Goals</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a sleeker look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-4 md:p-8 min-h-screen">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-white">Gamify Your <span class="text-emerald-400">Life</span></h1>
            <div class="text-right">
                <div class="text-lg font-semibold text-gray-300">Daily Streak: <span id="streak" class="text-xl font-bold text-amber-400">0</span></div>
            </div>
        </header>

        <!-- XP Bar -->
        <div class="mb-6 bg-gray-800 p-4 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-2 text-sm font-medium">
                <span id="level" class="text-emerald-400 font-bold text-lg">Level 1</span>
                <span id="xp" class="text-gray-400">0 / 100 XP</span>
            </div>
            <!-- Canvas for XP Bar -->
            <canvas id="xpBar" class="w-full h-4 rounded-full"></canvas>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Column: Add Quest & Quests List -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Add Quest Form -->
                <div class="bg-gray-800 p-5 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4">Add New Quest</h2>
                    <form id="addGoalForm" class="space-y-4">
                        <div>
                            <label for="goalText" class="block text-sm font-medium text-gray-400">Quest</label>
                            <input type="text" id="goalText" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" placeholder="e.g., Run for 20 minutes" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="goalCategory" class="block text-sm font-medium text-gray-400">Category</label>
                                <select id="goalCategory" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                    <option>Work</option>
                                    <option>Health</option>
                                    <option>Personal</option>
                                    <option>Chores</option>
                                </select>
                            </div>
                            <div>
                                <label for="goalDifficulty" class="block text-sm font-medium text-gray-400">Difficulty</label>
                                <select id="goalDifficulty" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                    <option value="10">Easy (10 XP)</option>
                                    <option value="25">Medium (25 XP)</option>
                                    <option value="50">Hard (50 XP)</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                            Add Quest
                        </button>
                    </form>
                </div>

                <!-- Quests List -->
                <div class="bg-gray-800 p-5 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4">Today's Quests</h2>
                    <div id="goalsList" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                        <!-- Goals will be dynamically injected here -->
                        <p id="noGoalsText" class="text-gray-500">No quests added for today. Add one above!</p>
                    </div>
                </div>

            </div>

            <!-- Right Column: Dashboard & Calendar -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Analysis Dashboard -->
                <div class="bg-gray-800 p-5 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4">Analysis Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Calendar Section -->
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <h3 id="calendarTitle" class="text-lg font-semibold text-center mb-3">Your Progress</h3>
                            <div id="progressCalendar" class="grid grid-cols-7 gap-1 text-center text-xs">
                                <!-- Calendar will be dynamically generated here -->
                            </div>
                        </div>
                        <!-- Category Breakdown -->
                        <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-center min-h-[250px] md:min-h-0">
                            <canvas id="categoryChart"></canvas>
                        </div>
                        <!-- Progress Overview -->
                        <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-center min-h-[250px] md:min-h-0 md:col-span-2">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <!-- Level Up Modal -->
    <div id="levelUpModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full text-center transform transition-all scale-95 opacity-0">
            <h2 class="text-4xl font-bold text-amber-400 mb-4">LEVEL UP!</h2>
            <p class="text-xl text-gray-200 mb-2">You've reached</p>
            <p id="newLevelText" class="text-6xl font-bold text-white mb-6">Level 2</p>
            <button id="closeModalButton" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                Continue
            </button>
        </div>
    </div>


    <script>
        // --- CHART & STATE INITIALIZATION ---
        const levelUpModal = document.getElementById('levelUpModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const newLevelText = document.getElementById('newLevelText');
        const goalsList = document.getElementById('goalsList');
        const noGoalsText = document.getElementById('noGoalsText');
        const addGoalForm = document.getElementById('addGoalForm');
        const goalText = document.getElementById('goalText');
        const goalCategory = document.getElementById('goalCategory');
        const goalDifficulty = document.getElementById('goalDifficulty');

        // Chart.js instances
        let categoryChart = null;
        let progressChart = null;
        
        // XP Bar Canvas
        const xpBarCanvas = document.getElementById('xpBar');
        const xpBarCtx = xpBarCanvas.getContext('2d');

        // Calendar Elements
        const calendarContainer = document.getElementById('progressCalendar');
        const calendarTitle = document.getElementById('calendarTitle');
        const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];

        // --- APPLICATION STATE ---
        let state = {
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            streak: 0,
            lastLogin: new Date().toISOString().split('T')[0],
            pendingGoals: [],
            completedGoals: []
        };

        // --- XP & LEVELING LOGIC ---

        /**
         * Calculates the XP needed for a given level.
         * @param {number} level - The level.
         * @returns {number} - The total XP required to reach that level.
         */
        function getXpForLevel(level) {
            // Simple exponential curve: 100, 120, 144, 173...
            return Math.floor(100 * Math.pow(1.2, level - 1));
        }

        /**
         * Adds XP to the user's state and handles leveling up.
         * @param {number} amount - The amount of XP to add.
         */
        function addXp(amount) {
            state.xp += amount;
            
            // Loop in case of multiple level-ups
            while (state.xp >= state.xpToNextLevel) {
                state.xp = state.xp - state.xpToNextLevel; // Rollover excess XP
                state.level++;
                state.xpToNextLevel = getXpForLevel(state.level);
                showLevelUpModal(state.level);
            }
            updateUI();
        }

        /**
         * Displays the level-up modal.
         * @param {number} newLevel - The new level to display.
         */
        function showLevelUpModal(newLevel) {
            newLevelText.textContent = `Level ${newLevel}`;
            levelUpModal.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                levelUpModal.querySelector('div').classList.remove('scale-95', 'opacity-0');
                levelUpModal.querySelector('div').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        /**
         * Hides the level-up modal.
         */
        function hideLevelUpModal() {
            levelUpModal.querySelector('div').classList.add('scale-95', 'opacity-0');
            levelUpModal.querySelector('div').classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                levelUpModal.classList.add('hidden');
            }, 300); // Wait for animation to finish
        }

        // --- STREAK LOGIC ---

        /**
         * Updates the user's streak based on the last login date.
         */
        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            if (state.lastLogin === today) {
                return; // Already logged in today
            }

            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            
            if (state.lastLogin === yesterday) {
                state.streak++;
            } else {
                state.streak = 1; // Reset streak if last login wasn't yesterday
            }
            state.lastLogin = today;
        }

        // --- DATA & STATE MANAGEMENT ---

        /**
         * Saves the current application state to localStorage.
         */
        function saveState() {
            localStorage.setItem('gamifyState', JSON.stringify(state));
        }

        /**
         * Loads the application state from localStorage.
         */
        function loadState() {
            const savedState = localStorage.getItem('gamifyState');
            if (savedState) {
                state = JSON.parse(savedState);
            }
            // Ensure data integrity after loading
            state.pendingGoals = state.pendingGoals || [];
            state.completedGoals = state.completedGoals || [];
            
            updateStreak(); // Check and update streak on load
            updateUI();
        }

        // --- GOAL MANAGEMENT ---

        /**
         * Adds a new goal to the pending list.
         * @param {Event} e - The form submission event.
         */
        function addGoal(e) {
            e.preventDefault();
            const text = goalText.value.trim();
            if (text === "") return;

            const newGoal = {
                id: `goal-${Date.now()}`,
                text: text,
                category: goalCategory.value,
                difficulty: parseInt(goalDifficulty.value, 10),
                dateAdded: new Date().toISOString().split('T')[0]
            };

            state.pendingGoals.push(newGoal);
            addGoalForm.reset();
            updateUI();
        }

        /**
         * Moves a goal from pending to completed and awards XP.
         * @param {string} goalId - The ID of the goal to complete.
         */
        function completeGoal(goalId) {
            const goalIndex = state.pendingGoals.findIndex(g => g.id === goalId);
            if (goalIndex === -1) return;

            // Remove from pending
            const [goal] = state.pendingGoals.splice(goalIndex, 1);
            
            // Add to completed
            goal.dateCompleted = new Date().toISOString().split('T')[0];
            state.completedGoals.push(goal);
            
            // Add XP
            addXp(goal.difficulty);
            
            // Don't call updateUI here, addXp does it.
        }
        
        /**
         * Deletes a goal from the pending list.
         * @param {string} goalId - The ID of the goal to delete.
         */
        function deleteGoal(goalId) {
            state.pendingGoals = state.pendingGoals.filter(g => g.id !== goalId);
            updateUI();
        }


        // --- UI RENDERING ---

        /**
         * Main function to update the entire UI based on the current state.
         */
        function updateUI() {
            renderGoalsList();
            renderStats();
            renderXPBar();
            renderCalendar(); // Add this call
            saveState();
        }

        /**
         * Renders the list of pending goals.
         */
        function renderGoalsList() {
            goalsList.innerHTML = ''; // Clear list
            if (state.pendingGoals.length === 0) {
                goalsList.appendChild(noGoalsText);
            } else {
                state.pendingGoals.forEach(goal => {
                    const el = document.createElement('div');
                    el.className = 'bg-gray-700 p-3 rounded-lg flex items-center justify-between shadow';
                    el.innerHTML = `
                        <div class="flex items-center">
                            <button data-complete-id="${goal.id}" class="complete-btn flex-shrink-0 w-6 h-6 border-2 border-gray-500 rounded-full hover:border-emerald-400 transition duration-200"></button>
                            <div class="ml-3">
                                <span class="block text-white">${goal.text}</span>
                                <span class="block text-xs text-gray-400">${goal.category} - ${goal.difficulty} XP</span>
                            </div>
                        </div>
                        <button data-delete-id="${goal.id}" class="delete-btn text-gray-500 hover:text-red-500 transition duration-200 text-lg">&times;</button>
                    `;
                    goalsList.appendChild(el);
                });
            }
        }

        /**
         * Renders the XP bar canvas.
         */
        function renderXPBar() {
            const width = xpBarCanvas.width;
            const height = xpBarCanvas.height;
            const progress = state.xp / state.xpToNextLevel;

            // Clear canvas
            xpBarCtx.clearRect(0, 0, width, height);

            // Draw background
            xpBarCtx.fillStyle = '#374151'; // gray-700
            xpBarCtx.fillRect(0, 0, width, height);

            // Draw foreground (XP) with gradient
            const gradient = xpBarCtx.createLinearGradient(0, 0, width * progress, 0);
            gradient.addColorStop(0, '#34D399'); // emerald-400
            gradient.addColorStop(1, '#10B981'); // emerald-500
            
            xpBarCtx.fillStyle = gradient;
            xpBarCtx.fillRect(0, 0, width * progress, height);
        }

        /**
         * Updates the header stats (Level, XP, Streak).
         */
        function renderStats() {
            document.getElementById('level').textContent = `Level ${state.level}`;
            document.getElementById('xp').textContent = `${state.xp} / ${state.xpToNextLevel} XP`;
            document.getElementById('streak').textContent = state.streak;
            
            renderDashboardCharts();
        }

        /**
         * NEW: Renders the progress calendar for the current month.
         */
        function renderCalendar() {
            calendarContainer.innerHTML = ''; // Clear calendar

            const today = new Date();
            const month = today.getMonth();
            const year = today.getFullYear();
            
            const monthName = today.toLocaleString('default', { month: 'long' });
            calendarTitle.textContent = `${monthName} ${year}`;

            const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0=Sun, 1=Mon...
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const todayDateString = today.toISOString().split('T')[0];

            // Get all unique completion dates for this month
            const completedDates = new Set(
                state.completedGoals
                    .filter(g => new Date(g.dateCompleted).getMonth() === month && new Date(g.dateCompleted).getFullYear() === year)
                    .map(g => g.dateCompleted)
            );

            // 1. Add day name headers
            dayNames.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.className = 'font-semibold text-gray-400';
                dayEl.textContent = day;
                calendarContainer.appendChild(dayEl);
            });

            // 2. Add spacer cells for the first day's offset
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarContainer.appendChild(document.createElement('div'));
            }

            // 3. Add day cells
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.textContent = i;
                dayEl.className = 'w-8 h-8 flex items-center justify-center rounded-full';
                
                const dayDateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                // Highlight today
                if (dayDateString === todayDateString) {
                    dayEl.classList.add('bg-emerald-600', 'text-white', 'font-bold');
                } else {
                     dayEl.classList.add('text-gray-300');
                }

                // Add ring for completed days
                if (completedDates.has(dayDateString)) {
                    dayEl.classList.add('ring-2', 'ring-emerald-400', 'ring-offset-2', 'ring-offset-gray-700');
                }
                
                calendarContainer.appendChild(dayEl);
            }
        }


        /**
         * Renders the two dashboard charts using Chart.js.
         */
        function renderDashboardCharts() {
            // --- Category Chart (Doughnut) ---
            const categoryData = {};
            state.completedGoals.forEach(g => {
                categoryData[g.category] = (categoryData[g.category] || 0) + 1;
            });
            
            const catCtx = document.getElementById('categoryChart').getContext('2d');
            if (categoryChart) {
                categoryChart.destroy(); // Destroy old chart instance
            }
            
            if (state.completedGoals.length === 0) {
                // Show placeholder if no data
                catCtx.clearRect(0, 0, catCtx.canvas.width, catCtx.canvas.height);
                catCtx.fillStyle = '#6B7280'; // gray-500
                catCtx.textAlign = 'center';
                catCtx.font = '16px Inter';
                catCtx.fillText('Complete quests to see your category stats!', catCtx.canvas.width / 2, catCtx.canvas.height / 2);
            } else {
                categoryChart = new Chart(catCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: ['#34D399', '#3B82F6', '#F59E0B', '#9CA3AF'],
                            borderColor: '#4B5563', // gray-700
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#D1D5DB' } // gray-300
                            },
                            title: {
                                display: true,
                                text: 'Completed Quest Categories',
                                color: '#F3F4F6' // gray-100
                            }
                        }
                    }
                });
            }

            // --- Progress Chart (Bar) ---
            const progressData = {
                completed: state.completedGoals.length,
                pending: state.pendingGoals.length
            };
            
            const progCtx = document.getElementById('progressChart').getContext('2d');
            if (progressChart) {
                progressChart.destroy();
            }

            if (progressData.completed === 0 && progressData.pending === 0) {
                 // Show placeholder if no data
                progCtx.clearRect(0, 0, progCtx.canvas.width, progCtx.canvas.height);
                progCtx.fillStyle = '#6B7280'; // gray-500
                progCtx.textAlign = 'center';
                progCtx.font = '16px Inter';
                progCtx.fillText('Add quests to see your progress!', progCtx.canvas.width / 2, progCtx.canvas.height / 2);
            } else {
                progressChart = new Chart(progCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Quest Progress'],
                        datasets: [
                            {
                                label: 'Completed',
                                data: [progressData.completed],
                                backgroundColor: '#10B981', // emerald-500
                            },
                            {
                                label: 'Pending',
                                data: [progressData.pending],
                                backgroundColor: '#6B7280', // gray-500
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y', // Horizontal bar chart
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                stacked: true,
                                grid: { color: '#4B5563' }, // gray-600
                                ticks: { color: '#D1D5DB', beginAtZero: true, stepSize: 1 } // gray-300
                            },
                            y: {
                                stacked: true,
                                grid: { display: false },
                                ticks: { color: '#D1D5DB' } // gray-300
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#D1D5DB' } // gray-300
                            },
                            title: {
                                display: true,
                                text: 'Quest Overview',
                                color: '#F3F4F6' // gray-100
                            }
                        }
                    }
                });
            }
        }


        // --- EVENT LISTENERS ---

        // Add goal form submit
        addGoalForm.addEventListener('submit', addGoal);

        // Close modal button
        closeModalButton.addEventListener('click', hideLevelUpModal);

        // Click listener for complete and delete buttons (using event delegation)
        goalsList.addEventListener('click', (e) => {
            const completeBtn = e.target.closest('.complete-btn');
            const deleteBtn = e.target.closest('.delete-btn');

            if (completeBtn) {
                const id = completeBtn.dataset.completeId;
                // Add visual confirmation
                completeBtn.classList.add('bg-emerald-500', 'border-emerald-500');
                // Wait for animation before completing logic
                setTimeout(() => {
                    completeGoal(id);
                }, 300);
                return; // Prevent delete from firing
            }

            if (deleteBtn) {
                const id = deleteBtn.dataset.deleteId;
                // Add visual confirmation
                deleteBtn.parentElement.classList.add('opacity-0', 'scale-95', 'translate-x-4');
                // Wait for animation before deleting logic
                setTimeout(() => {
                    deleteGoal(id);
                }, 300);
            }
        });

        // Resize canvas elements on window resize
        window.addEventListener('resize', () => {
            // Resize XP bar canvas
            xpBarCanvas.width = xpBarCanvas.clientWidth;
            xpBarCanvas.height = xpBarCanvas.clientHeight;
            renderXPBar();

            // Chart.js charts will resize automatically with `responsive: true`
            // but we might need to redraw placeholders if they exist
            if (state.completedGoals.length === 0 && state.pendingGoals.length === 0) {
                renderDashboardCharts();
            }
        });

        // --- INITIALIZATION ---
        
        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial canvas dimensions
            xpBarCanvas.width = xpBarCanvas.clientWidth;
            xpBarCanvas.height = xpBarCanvas.clientHeight;
            
            loadState();
        });

    </script>
</body>
</html>

